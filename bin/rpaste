#! /usr/bin/env bash

port_default=52698
port=${port_default}

function is_port_listened() {
  [ -n "${1}" ] && netstat -na | grep "127.0.0.1.${1}" 2>&1 >/dev/null
}

while getopts ":p:" o; do
  case "${o}" in
    p)
      port=${OPTARG}
      ;;
    *)
      echo "Usage: ${0} [-p <int>]" 1>&2; exit 1
      ;;
  esac
done

if ! $(is_port_listened); then
  port=${port_default}
fi

exec 3<>/dev/tcp/localhost/${port}
echo "get" >&3
cat <&3
exec 3>&-
